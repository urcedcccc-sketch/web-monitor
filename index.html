<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>监测控制台</title>
    <style>
        body { font-family: system-ui; max-width: 500px; margin: 50px auto; padding: 20px; background: #f4f4f9; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #2ea44f; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        button:hover { background: #2c974b; }
        #log { margin-top: 15px; font-size: 13px; color: #666; }
    </style>
</head>
<body>
    <div class="card">
        <h3>配置监测任务</h3>
        <input type="text" id="urlInput" placeholder="请输入监测目标 URL">
        <input type="password" id="tokenInput" placeholder="粘贴你的 GitHub Token (ghp_...)">
        <button onclick="updateGithub()">同步配置并开始监测</button>
        <div id="log"></div>
    </div>

    <script>
        async function updateGithub() {
            const url = document.getElementById('urlInput').value;
            const token = document.getElementById('tokenInput').value;
            const log = document.getElementById('log');
            const repo = "你的用户名/web-monitor"; // ⚠️记得修改这里！

            log.innerText = "正在获取旧文件信息...";
            
            try {
                // 1. 获取原文件内容（为了拿到 sha 值）
                const res = await fetch(`https://api.github.com/repos/${repo}/contents/url.txt`, {
                    headers: { "Authorization": `token ${token}` }
                });
                const data = await res.json();
                const sha = data.sha;

                // 2. 更新文件内容
                const updateRes = await fetch(`https://api.github.com/repos/${repo}/contents/url.txt`, {
                    method: "PUT",
                    headers: { "Authorization": `token ${token}`, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        message: "Update monitor URL",
                        content: btoa(url), // Base64 编码
                        sha: sha
                    })
                });

                if(updateRes.ok) log.innerText = "✅ 成功！GitHub Actions 将在5分钟内启动。";
                else log.innerText = "❌ 失败，请检查 Token 权限或仓库路径。";
            } catch (e) {
                log.innerText = "错误: " + e.message;
            }
        }
    </script>
</body>
</html>

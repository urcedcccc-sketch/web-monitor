<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ç›‘æµ‹æ§åˆ¶å°</title>
    <style>
        body { font-family: system-ui; max-width: 500px; margin: 50px auto; padding: 20px; background: #f4f4f9; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #2ea44f; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        button:hover { background: #2c974b; }
        #log { margin-top: 15px; font-size: 13px; color: #666; }
    </style>
</head>
<body>
    <div class="card">
        <h3>é…ç½®ç›‘æµ‹ä»»åŠ¡</h3>
        <input type="text" id="urlInput" placeholder="è¯·è¾“å…¥ç›‘æµ‹ç›®æ ‡ URL">
        <input type="password" id="tokenInput" placeholder="ç²˜è´´ä½ çš„ GitHub Token (ghp_...)">
        <button onclick="updateGithub()">åŒæ­¥é…ç½®å¹¶å¼€å§‹ç›‘æµ‹</button>
        <div id="log"></div>
    </div>

    <script>
       async function updateGithub() {
            const url = document.getElementById('urlInput').value;
            const token = document.getElementById('tokenInput').value;
            const log = document.getElementById('log');
            const repo = "urcedcccc-sketch/web-monitor"; // ğŸ‘ˆ å†æ¬¡ç¡®è®¤è¿™é‡Œï¼

            try {
                // ç¬¬ä¸€æ­¥ï¼šå°è¯•è¯»å–
                const res = await fetch(`https://api.github.com/repos/${repo}/contents/url.txt`, {
                    headers: { "Authorization": `token ${token}` }
                });
                
                if (res.status === 404) {
                    log.innerText = "âŒ é”™è¯¯ï¼šæ‰¾ä¸åˆ° url.txt æ–‡ä»¶ï¼Œè¯·å…ˆåœ¨ä»“åº“æ‰‹åŠ¨åˆ›å»ºå®ƒã€‚";
                    return;
                } else if (res.status === 401) {
                    log.innerText = "âŒ é”™è¯¯ï¼šToken æ— æ•ˆæˆ–å·²è¿‡æœŸã€‚";
                    return;
                }

                const data = await res.json();
                const sha = data.sha;

                // ç¬¬äºŒæ­¥ï¼šå°è¯•å†™å…¥
                const updateRes = await fetch(`https://api.github.com/repos/${repo}/contents/url.txt`, {
                    method: "PUT",
                    headers: { "Authorization": `token ${token}`, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        message: "Update monitor URL",
                        content: btoa(url),
                        sha: sha
                    })
                });

                if(updateRes.ok) {
                    log.innerText = "âœ… åŒæ­¥æˆåŠŸï¼";
                } else {
                    const errorMsg = await updateRes.json();
                    log.innerText = "âŒ å†™å…¥å¤±è´¥: " + errorMsg.message;
                }
            } catch (e) {
                log.innerText = "ç½‘ç»œé”™è¯¯: " + e.message;
            }
        }
    </script>
</body>
</html>
